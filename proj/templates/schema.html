<!DOCTYPE html>
{% if authorized %}
<html>
<head>
    <title>Table Information</title>
</head>
<body>
    <h1>Table Information</h1>

    <h2>Primary Key Fields</h2>
    <ul>
        {% for field in primary_key_fields %}
        <li>{{ field }}</li>
        {% endfor %}
    </ul>

    <h2>Fields with NOT NULL Constraints</h2>
    <ul>
        {% for field in not_null_fields %}
        <li>{{ field }}</li>
        {% endfor %}
    </ul>

    <h2>Foreign Key Fields</h2>
    <ul>
        {% for field, table in foreign_key_fields %}
        <li>{{ field }} -> {{ table }}</li>
        {% endfor %}
    </ul>
</body>
</html>
{% else %}
<html>
	<head>
		<link rel="stylesheet" type="text/css" href="{{url_for('static', filename = 'button.css')}}">
		<link rel="stylesheet" type="text/css" href="{{url_for('static', filename = 'trackform.css')}}">
	</head>
	<body>

		<form id="track-auth-form">
			<label for="trackpw">Please sign in to view schema tool (The password is exactly what you think it is)</label>
			<input type="password" name="trackpw">
			<button id="track-auth-submit-btn" class="btn btn-primary" type="submit">Submit</button>
		</form>
	</body>
	<script type="text/javascript">
		document.getElementById('track-auth-form')?.addEventListener('submit', (event) => {
			event.preventDefault();
			const formData = new FormData(event.target);
			console.log(JSON.stringify(Object.fromEntries(formData.entries())))
			fetch(
				`{{request.script_root}}/trackauth`, 
				{
					method: 'POST',
					headers: {
						'Content-Type': 'application/json'
					},
					body: JSON.stringify(Object.fromEntries(formData.entries()))
			}
			)
			.then(response => {
				if (!response.ok) {
					throw new Error('Network response was not ok');
				}
				return response.json();
			})
			.then(data => {
				console.log(data);
				if (data.message === 'true') {
					window.location = `{{request.script_root}}/track`
				}
			})
			.catch(error => {
				console.error('There was a problem submitting the form', error);
			});
		})
	</script>
</html>
{% endif %}